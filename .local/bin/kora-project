#!/usr/bin/env bash

# ~/.local/bin/kora-project
# KORA: Wizard para criar projetos de diferentes tipos.

log() { echo "üêâ KORA PROJ: $1"; }
warn() { echo "‚ö†Ô∏è  KORA PROJ: Aviso - $1"; }
error() { echo "‚ùå KORA PROJ: Erro - $1"; exit 1; }

# Verifica se o fzf est√° instalado
if ! command -v fzf &> /dev/null
then
    error "fzf n√£o encontrado. Por favor, instale-o."
fi

log "Iniciando wizard de projeto..."

PROJECT_TYPE=$(printf "Python\nNode.js\nReact\nNext.js\nGo\nRust\nJava\nDocker" | fzf --prompt="Escolha o tipo de projeto: " --height=20%)

if [ -z "$PROJECT_TYPE" ]; then
    log "Cria√ß√£o de projeto cancelada."
    exit 0
fi

read -p "Nome do projeto: " PROJECT_NAME
if [ -z "$PROJECT_NAME" ]; then
    error "Nome do projeto n√£o pode ser vazio."
fi

# Cria o diret√≥rio do projeto e navega para ele
mkdir -p "$PROJECT_NAME" || error "Falha ao criar o diret√≥rio do projeto."
cd "$PROJECT_NAME" || error "Falha ao entrar no diret√≥rio do projeto."

case "$PROJECT_TYPE" in
    "Python")
        log "Criando projeto Python..."
        python3 -m venv .venv
        echo "## $PROJECT_NAME" > README.md
        echo "from flask import Flask" > app.py
        echo "requirements.txt" > .gitignore
        log "Projeto Python criado. Use 'source .venv/bin/activate'."
        ;;
    "Node.js")
        log "Criando projeto Node.js..."
        npm init -y
        echo "console.log('Hello Kora!');" > index.js
        echo "node_modules" > .gitignore
        log "Projeto Node.js criado. Use 'npm install'."
        ;;
    "React")
        log "Criando projeto React com Vite..."
        npm create vite@latest . -- --template react
        log "Projeto React criado. Execute 'npm install' e 'npm run dev'."
        ;;
    "Next.js")
        log "Criando projeto Next.js..."
        npx create-next-app@latest .
        log "Projeto Next.js criado. Execute 'npm install' e 'npm run dev'."
        ;;
    "Go")
        log "Criando projeto Go..."
        go mod init "$PROJECT_NAME"
        echo "package main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"Hello Kora!\")\n}" > main.go
        log "Projeto Go criado. Use 'go run .'."
        ;;
    "Rust")
        log "Criando projeto Rust..."
        cargo init --bin .
        log "Projeto Rust criado. Use 'cargo run'."
        ;;
    "Java")
        log "Criando projeto Java (padr√£o)..."
        mkdir -p src bin
        echo "public class Main { public static void main(String[] args) { System.out.println(\"Hello Kora!\"); } }" > src/Main.java
        log "Projeto Java criado. Compile com 'javac src/Main.java -d bin'."
        ;;
    "Docker")
        log "Criando projeto com Dockerfile e docker-compose.yml..."
        touch Dockerfile docker-compose.yml .gitignore
        log "Projeto Docker criado. Edite os arquivos para sua aplica√ß√£o."
        ;;
esac

log "Projeto '$PROJECT_NAME' do tipo '$PROJECT_TYPE' criado com sucesso!"
echo "Use 'lg' para inicializar o reposit√≥rio git."
