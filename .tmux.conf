# ~/.tmux.conf ‚Äî KORA Matrix v3: Solo Leveling Edition
# Responsabilidade: Configurar o multiplexador de terminal Tmux.
# Princ√≠pio: Coer√™ncia visual, produtividade.

# --- Configura√ß√£o Core ---
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*:Tc,*:RGB"
set -g default-shell $SHELL

# Prefixo (Ctrl+A)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Otimiza√ß√£o de Performance
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000
set -sg escape-time 0
set -g mouse on
setw -g mode-keys vi # Modo de c√≥pia estilo Vi
set -g focus-events on
set -g detach-on-destroy off
set -g display-time 2000

# --- Cores (Paleta Solo Leveling) ---
# Cores base
neural_void="#0d0d1a"
neural_surface="#1c1c2e"
neural_text="#c0c0ff"
neural_muted="#6a5acd"

# Cores de destaque
neural_primary="#A020F0"
neural_cyan="#00FFFF"
neural_magenta="#FF00FF"
neural_green="#00FF7F"
neural_yellow="#FF00FF"
neural_red="#FF00FF"

# --- Status Bar Neural (Cont√≠nua) ---
set -g status-interval 1
set -g status-position top
set -g status-justify left
set -g status-style "bg=$neural_void,fg=$neural_text"
set -g status-left-length 200
set -g status-right-length 200

# Separadores (estilo Powerline)
separator_left="#[fg=$neural_primary,bg=$neural_void,nobold]ÓÇ∞"
separator_right="#[fg=$neural_primary,bg=$neural_void,nobold]ÓÇ≤"

# Lado Esquerdo
status_left_1="#[fg=$neural_void,bg=$neural_primary,bold] Û∞£á #S "
status_left_2="#[fg=$neural_text,bg=$neural_surface] #{?session_many_attached,Û∞Ä† LINKED,Û∞òî SOLO} "
set -g status-left "$status_left_1$separator_left$status_left_2#[fg=$neural_surface,bg=$neural_void]ÓÇ∞"

# Lado Direito
# Chama a fun√ß√£o spell_vitals (definida em spellbook.zsh) para informa√ß√µes din√¢micas
status_right_1="#[fg=$neural_surface,bg=$neural_void]ÓÇ≤#[bg=$neural_surface,fg=$neural_text] #(spell_vitals) "
status_right_2="#[fg=$neural_primary,bg=$neural_surface]ÓÇ≤#[bg=$neural_primary,fg=$neural_void,bold] Û∞•î %H:%M "
set -g status-right "$status_right_1$status_right_2"

# Janelas
set -g window-status-current-format "#[fg=$neural_void,bg=$neural_yellow]ÓÇ∞#[fg=$neural_void,bg=$neural_yellow,bold] #I Û∞ñ≤ #W #[fg=$neural_yellow,bg=$neural_void,nobold]ÓÇ∞"
set -g window-status-format "#[fg=$neural_text,bg=$neural_void] #I Û∞ñ≤ #W "
set -g window-status-separator ""

# --- Pain√©is ---
set -g pane-border-style "fg=$neural_muted"
set -g pane-active-border-style "fg=$neural_primary,bold"
set -g pane-border-lines heavy
set -g display-panes-time 3000
set -g display-panes-colour "$neural_primary"
set -g display-panes-active-colour "$neural_cyan"

# --- Mensagens ---
set -g message-style "fg=$neural_void,bg=$neural_primary,bold"
set -g message-command-style "fg=$neural_void,bg=$neural_cyan,bold"
set -g mode-style "fg=$neural_void,bg=$neural_primary,bold"
set -g copy-mode-match-style "fg=$neural_void,bg=$neural_yellow,bold"
set -g copy-mode-current-match-style "fg=$neural_void,bg=$neural_green,bold"

# --- Gerenciamento de Janelas e Pain√©is ---
# Cria√ß√£o com paths neurais
bind c new-window -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Navega√ß√£o neural (Vim-style)
bind h select-pane -L
bind j select-pane -D  
bind k select-pane -U
bind l select-pane -R

# Redimensionamento neural com precis√£o
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Ajustes micro
bind -r M-h resize-pane -L 1
bind -r M-j resize-pane -D 1
bind -r M-k resize-pane -U 1
bind -r M-l resize-pane -R 1

# Troca de janelas neural
bind Tab last-window
bind -r C-h select-window -t :- 
bind -r C-l select-window -t :+

# Acesso r√°pido neural
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# --- Modo de C√≥pia Neural ---
bind v copy-mode
bind p paste-buffer
bind C-p choose-buffer

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# --- Gerenciamento de Sess√£o Neural ---
# Main neural session switcher (usa sesh se dispon√≠vel)
bind-key "K" display-popup -E -w 90% -h 80% -x C -y C '\n  if command -v sesh >/dev/null 2>&1; then
    sesh connect "$(sesh list --icons | fzf \
      --ansi \
      --border=rounded \
      --border-label=\"  KORA Neural Session Matrix  \" \
      --prompt=\"Û∞£á \" \
      --pointer=\"\" \
      --marker=\"Û∞Ñ¨\" \
      --color=\"fg:#c0c0ff,bg:#0d0d1a,hl:#A020F0\" \
      --color=\"fg+:#0d0d1a,bg+:#A020F0,hl+:#00FFFF\" \
      --color=\"border:#A020F0,header:#00FFFF,info:#00FF7F\" \
      --color=\"spinner:#FF00FF,pointer:#FF00FF,marker:#00FF7F\" \
      --header=\" Neural Interface ‚îÇ Operator: Saiiru@$(hostname) ‚îÇ $(date +\"%Y-%m-%d %H:%M:%S UTC\")\" \
      --preview=\"echo \" NEURAL SESSION ANALYSIS\" && echo \"‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî\" && sesh preview {} 2>/dev/null | head -15 || echo \" No neural data available\"\" \
      --preview-window=\"right:45%:wrap:rounded\" \
      --height=100% \
      --layout=reverse \
      --info=inline \
      --cycle \
    )"
  else
    tmux choose-session
  fi'

# Quick neural access
bind-key "s" display-popup -E -w 65% -h 60% -x C -y C '\n  if command -v sesh >/dev/null 2>&1; then
    sesh connect "$(sesh list | fzf \
      --prompt=\"Û∞£á Quick: \" \
      --border=rounded \
      --border-label=\"  Neural Quick Access  \" \
      --color=\"fg:#c0c0ff,bg:#0d0d1a,border:#A020F0\" \
      --color=\"fg+:#0d0d1a,bg+:#A020F0\" \
    )"
  else
    tmux choose-session
  fi'

# Neural session creator
bind-key "N" display-popup -E -w 80% -h 70% -x C -y C '\n  clear
  echo "                      Û∞£á                      "
  echo "             KORA NEURAL MATRIX              "
  echo "          SESSION CREATION PROTOCOL          "
  echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"
  echo " NEURAL TEMPLATES:"
  echo "   Û∞øü [p] Project Session    Û∞øü [w] Work Session"
  echo "   Û∞øü [d] Development        Û∞øü [t] Temporary"
  echo "   Û∞øü [c] Coding Session     Û∞øü [m] Monitoring"
  echo "   Û∞øü [r] Research           Û∞øü [x] Experiment"
  echo
  echo " üìç Current Location: $(pwd)"
  echo " üïí Neural Time: $(date +\"%H:%M:%S\")"
  echo " üë§ Operator: Saiiru"
  echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"
  echo
  read -p "Û∞£á Neural session identifier: " input
  
  if [ -n "$input" ]; then
    case "$input" in
      p|project) name=\"project-$(basename $(pwd))\" ;; 
      w|work) name=\"work-$(date +%Y%m%d)\" ;; 
      d|dev) name=\"dev-$(basename $(pwd))\" ;; 
      t|tmp) name=\"tmp-$(date +%H%M)\" ;; 
      c|coding) name=\"coding-$(basename $(pwd))\" ;; 
      m|monitor) name=\"monitor-$(hostname)\" ;; 
      r|research) name=\"research-$(date +%m%d)\" ;; 
      x|experiment) name=\"exp-$(date +%H%M)\" ;; 
      *) name=\"$input\" ;; 
    esac
    
    echo "Û∞£á Initializing neural session: $name"
    echo "üîÑ Establishing neural links..."
    if command -v sesh >/dev/null 2>&1; then
      sesh connect "$name"
    else
      tmux new-session -d -s "$name" -c "$(pwd)" && tmux switch-client -t "$name"
    fi
  fi'

# Neural intelligence report
bind-key "i" display-popup -E -w 75% -h 75% -x C -y C '\n  clear
  echo "                      Û∞£á                      "
  echo "             KORA NEURAL MATRIX              "
  echo "           INTELLIGENCE REPORT               "
  echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"
  echo
  echo " SESSION NEURAL DATA:"
  echo "   Û∞íã Active Session: $(tmux display-message -p \"#S\")"
  echo "   Û∞æ∏ Neural Windows: $(tmux list-windows | wc -l)"
  echo "   Û∞Éû Active Panes: $(tmux list-panes -s | wc -l)"
  echo "   Û∞øü Total Sessions: $(tmux list-sessions | wc -l)"
  echo "   Û∞É≠ Current Path: $(tmux display-message -p \"#{pane_current_path}\")"
  echo "   Û∞ûÅ Process: $(tmux display-message -p \"#{pane_current_command}\")"
  echo
  echo " SYSTEM NEURAL STATUS:"
  echo "   üïí Neural Time: $(date +\"%Y-%m-%d %H:%M:%S UTC\")"
  echo "   ‚ö° System Uptime: $(uptime | cut -d, -f1 | cut -d\" \" -f4-)"
  echo "   Û∞çõ Load Average: $(uptime | awk -F\"load average:\" \"{print \$2}\" | awk \"{print \$1}\" | sed \"s/,//\")"
  echo "   Û∞æÜ Memory Usage: $(free -h 2>/dev/null | awk \"/^Mem:/ {print \$3\"/\"\$2}\" || echo \"N/A\")"
  echo "   Û∞ãä Storage: $(df -h / 2>/dev/null | tail -1 | awk \"{print \$3\"/\"\$2\" (\"\$5\")}\" || echo \"N/A\")"
  echo "   Û∞íã Host: $(hostname)"
  echo "   üë§ Operator: Saiiru"
  echo
  echo " NEURAL NETWORK STATUS:"
  echo "   Û∞£á TMUX Version: $(tmux -V 2>/dev/null || echo \"Unknown\")"
  echo "   üêö Shell: $(basename $SHELL)"
  echo "   üñ•Ô∏è Terminal: $TERM"
  
  if command -v sesh >/dev/null 2>&1; then
    echo "   üß† Sesh Neural Network: ‚úÖ ONLINE ($(sesh list 2>/dev/null | wc -l) sessions)"
  else
    echo "   üß† Sesh Neural Network: ‚ùå OFFLINE"
  fi
  
  echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"
  echo "Û∞£á Neural analysis complete. Press [ENTER] to continue..."
  read 
'

# Last neural session
bind-key "L" run-shell 'sesh last 2>/dev/null || tmux switch-client -l 2>/dev/null || tmux display-message "Û∞£á No previous neural session"'

# --- Aplica√ß√µes Neurais ---
# Ferramentas neurais do sistema
bind F1 new-window -n "Û∞ÑÑ neural-monitor" 'btop 2>/dev/null || htop 2>/dev/null || top'
bind F2 new-window -n "Û∞âì neural-logs" 'journalctl -f 2>/dev/null || tail -f /var/log/system.log 2>/dev/null || echo "No neural logs available"'
bind F3 new-window -n "Û∞ä¢ neural-git" 'lazygit 2>/dev/null || echo "Install lazygit for enhanced neural git interface"'
bind F4 new-window -n "‚öôÔ∏è neural-config" 'nvim ~/.tmux.conf'
bind F5 split-window -h -p 35 'while true; do clear; echo "                Û∞£á               "; echo "        KORA NEURAL MONITOR       "; echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"; echo "üïí $(date +\"%H:%M:%S\")"; echo "‚ö° Load: $(uptime | awk -F\"load average:\" \"{print \$2}\" | awk \"{print \$1}\" | sed \"s/,//\")"; echo "Û∞æÜ Memory: $(free -h 2>/dev/null | awk \"/^Mem:/ {print \$3\"/\"\$2}\" || echo \"N/A\")"; echo "Û∞ãä Disk: $(df -h / 2>/dev/null | tail -1 | awk \"{print \$3\"/\"\$2\" (\"\$5\")}\" || echo \"N/A\")"; echo "Û∞çõ Processes: $(ps aux | wc -l)"; echo "‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî‚ñî"; sleep 2; done'

# Ferramentas neurais de desenvolvimento
bind g new-window -c "#{pane_current_path}" -n "Û∞ä¢ neural-git" 'lazygit 2>/dev/null || echo "Install lazygit for enhanced neural git interface"'
bind e new-window -c "#{pane_current_path}" -n "Û∞ï∑ neural-editor" 'nvim .'
bind t new-window -c "#{pane_current_path}" -n "Û∞ô® neural-test" 'npm test 2>/dev/null || python -m pytest 2>/dev/null || cargo test 2>/dev/null || echo "No neural test protocols detected"'
bind b new-window -c "#{pane_current_path}" -n "Û∞Üß neural-build" 'npm run build 2>/dev/null || yarn build 2>/dev/null || make 2>/dev/null || cargo build 2>/dev/null || echo "No neural build matrix detected"'
bind d split-window -v -l 12 'npm run dev 2>/dev/null || yarn dev 2>/dev/null || python -m http.server 8000 2>/dev/null || echo "No neural dev server available"'

# Gerenciamento neural de arquivos
bind f new-window -c "#{pane_current_path}" -n "Û∞âã neural-files" 'ranger 2>/dev/null || lf 2>/dev/null || ls -la --color=always'

# --- Produtividade Neural ---
# Recarregar config neural
bind r source-file ~/.tmux.conf \; display-message "Û∞£á KORA neural matrix reloaded"

# Alternar status neural
bind B if -F '#{s/off//:status}' 'set status off; display-message "Û∞£á Neural HUD: HIDDEN"' 'set status on; display-message "Û∞£á Neural HUD: VISIBLE"'

# Sincroniza√ß√£o neural
bind Y setw synchronize-panes \; display-message "#{?synchronize-panes,üîó Neural Sync: ACTIVE,üîó Neural Sync: INACTIVE}"

# Opera√ß√µes de renomea√ß√£o neural
bind R command-prompt -I "#{window_name}" "rename-window '%%'"
bind '$' command-prompt -I "#{session_name}" "rename-session '%%'"

# Termina√ß√£o neural
bind x confirm-before -p "Terminate neural pane #P? (y/n)" kill-pane
bind X confirm-before -p "Terminate neural window #W? (y/n)" kill-window

# Limpar neural
bind C-l send-keys 'C-l' \; clear-history

# --- Plugins Neurais ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# Configura√ß√µes de plugins neurais
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @yank_with_mouse on

# --- Integra√ß√£o Terminal Neural ---
# Kitty neural integration
if-shell 'test -n "$KITTY_WINDOW_ID"' {
  bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "kitty +kitten clipboard"
}

# Outras integra√ß√µes de clipboard neural
if-shell 'command -v pbcopy' {
  bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
}

if-shell 'command -v xclip' {
  bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"
}

if-shell 'command -v wl-copy' {
  bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
}

# --- Inicializa√ß√£o da Matriz Neural ---
# Inicializa plugins TPM neurais
run '~/.tmux/plugins/tpm/tpm'

# Notifica√ß√£o de matriz neural online
display-message "Û∞£á KORA Neural Matrix V4.4 Online - All systems operational"
